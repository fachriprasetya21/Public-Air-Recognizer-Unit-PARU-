<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"> </script>
        <link rel="stylesheet" href="style_vgg16.css">
        <title>PM10 PREDICTION</title>
    </head>
    <script>
        var saveButton, clearButton;
        var rawImage;
        var model;
        var imageArray = [];
        var prediction;

        function displayImages(imgArr) {
            const url = URL.createObjectURL(imgArr);
            rawImage.src = url;
        }

        function erase() {
            rawImage.src = "#";
        }

        async function save() {
            document.getElementById("status").innerHTML = "Start Predicting...";
            prediction = await model.predict(tf.browser.fromPixels(rawImage).cast('int32').expandDims());
            document.getElementById("status").innerHTML = "Prediction result:";
            document.getElementById("output").innerHTML = "PM10: " + prediction.dataSync()[0];
        }

        async function run() {
            const MODEL_URL = 'model/model.json';
            model = await tf.loadLayersModel(MODEL_URL);
            console.log(model.summary());
            document.getElementById("caution").style = "color: white;";
            alert("Ready to Classify!");
            const input = document.getElementById("finput");
            rawImage = document.getElementById('canvasimg');
            saveButton = document.getElementById('sb');
            saveButton.addEventListener("click", save);
            clearButton = document.getElementById('cb');
            clearButton.addEventListener("click", erase);
            input.addEventListener("change", () => {
                const file = input.files;
                imageArray = file[0];
                displayImages(imageArray);
            });
        }

        document.addEventListener("DOMContentLoaded", run);
    </script>
    <body>
        <div class="card">
            <div class="box">
                <h1>PM10 Prediction! (using pre-defined model)</h1>
                <h2 style="margin-bottom: 0px;">Get some example files <a href="https://www.kaggle.com/datasets/adarshrouniyar/air-pollution-image-dataset-from-india-and-nepal?select=Air+Pollution+Image+Dataset" target="_blank">here</a>.</h2>
                <p style="margin-top: 0px; margin-bottom: 0px;">You can find the pre-defined model <a href="https://github.com/C23-PC729/c23-pc729.github.io/tree/main/model" target="_blank">here</a>.<br></p>
            </div>
            <div class="text">
                <h3 id="caution" style="color: red;">Wait until an alert appear!</h3>
            </div>
            <div class="card-container">
                <img id="canvasimg" >
                <input type="file" id="finput" accept="image/jpeg, image/png, image/jpg" >
                <input type="button" value="classify" id="sb" >
                <input type="button" value="clear" id="cb" >
            </div>
            <div class="card-container">
                <p id="status" ></p>
                <p id="output"></p>
            </div>
                
            
        </div>
        <div class="container">
            <h1>Here are another example</h1>
            <p>Click <a href="simplePrediction.html">here</a> to try float prediction with training!</p>
        </div>
    </body>
</html>
